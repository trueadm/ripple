<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/x-icon" sizes="48x48" href="/favicon.ico" />
		<link rel="icon" type="image/svg+xml" sizes="any" href="/favicon.svg" />
		<title>Ripple playground</title>
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				height: 100vh; /* for older browsers */
				height: 100dvh;
				overflow: hidden;
			}
		</style>

		<script type="module">
			import { createPlayground } from 'https://cdn.jsdelivr.net/npm/livecodes@0.11.1';

			const playgroundUrl = 'https://ripple.livecodes.pages.dev';
			const apiUrl = 'https://data.jsdelivr.com/v1/packages/npm/ripple';

			const pkg = await fetch(apiUrl)
				.then((res) => res.json())
				.catch(() => ({}));
			const latest = pkg.tags?.latest || 'latest';

			const code = `
import { track } from 'ripple';

export default component App() {
  <div class="container">
    let count = track(0);

    <button onClick={() => @count++}>{@count}</button>

    if (@count > 1) {
      <div>{"Greater than 1!"}</div>
    }
  </div>

  <style>
    button {
      padding: 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
}
`.trimStart();

			const defaultConfig = {
				customSettings: { ripple: { version: latest } },
				activeEditor: 'script',
				script: {
					language: 'ripple',
					content: code,
				},
				markup: {
					language: 'html',
					hideTitle: true,
				},
				style: {
					language: 'css',
					hideTitle: true,
					content: `body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background: hsl(0, 0%, 18%); color: #fff }`,
				},
			};

			const hash = window.location.hash;

			const playground = await createPlayground('#container', {
				appUrl: hash ? `${playgroundUrl}${hash.replace('#', '?')}` : playgroundUrl,
				loading: 'eager',
				config: hash ? undefined : defaultConfig,
			});

			playground.watch('code', async () => {
				const shareUrl = await playground.getShareUrl();
				window.location.hash = new URL(shareUrl).hash;
			});
		</script>
	</head>
	<body>
		<div id="container" data-default-styles="false" data-height="100%"></div>
	</body>
</html>
